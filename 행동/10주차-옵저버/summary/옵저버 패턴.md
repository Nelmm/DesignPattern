# ì˜µì €ë²„ íŒ¨í„´

> ë‹¤ìˆ˜ì˜ ê°ì²´ê°€ **íŠ¹ì • ê°ì²´ ìƒíƒœ ë³€í™”ë¥¼ ê°ì§€í•˜ê³  ì•Œë¦¼**ì„ ë°›ëŠ” íŒ¨í„´

![](https://refactoring.guru/images/patterns/diagrams/observer/structure.png?id=365b7e2b8fbecc8948f34b9f8f16f33c)

- **Publisher** : ì—¬ëŸ¬ êµ¬ë…ìë¥¼ ë“±ë¡/í•´ì§€í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤. êµ¬ë…ìë“¤ì˜ ìƒíƒœë¥¼ ë³€ê²½í•˜ê±°ë‚˜, í–‰ë™ì„ ì§ì ‘ì ìœ¼ë¡œ ì‹¤í–‰ì‹œí‚¬ ìˆ˜ ìˆëŠ” ê¶Œë¦¬ë¥¼ ê°€ì§„ë‹¤.

- **Subscriber**: ì´ë²¤íŠ¸ ë°œìƒì‹œ êµ¬ë…ìì—ì„œ í˜¸ì¶œí•˜ëŠ” ë©”ì†Œë“œë¥¼ ì¶”ê°€í•œë‹¤. 

- **Concrete Subscribers**: ì‹¤ì œë¡œ êµ¬ë…ìê°€ í•´ì•¼í• ì¼ì„ êµ¬í˜„í•œë‹¤.

ì¦‰, ë°œí–‰-êµ¬ë… í˜•ì‹ì˜ íŒ¨í„´ì´ êµ¬í˜„ëœë‹¤. 

## ì˜µì €ë²„ íŒ¨í„´ì€ ì–¸ì œ ì‚¬ìš©ë˜ëŠ”ê°€?

- ì™¸ë¶€ì—ì„œ ë°œìƒí•œ ì´ë²¤íŠ¸ì— ëŒ€í•œ ì‘ë‹µì„ ì „ë‹¬ í•´ì£¼ê³  ì‹¶ì„ë•Œ (ì´ë²¤íŠ¸ ê¸°ë°˜ í”„ë¡œê·¸ë˜ë°)

- ê°ì²´ ì†ì„± ê°’ì´ ë³€í•˜ëŠ” ê²½ìš° ì‘ë‹µì£¼ê³  ì‹¶ì€ ê²½ìš°

- ì±„íŒ… ì„œë¹„ìŠ¤

## ì˜µì €ë²„ íŒ¨í„´ ì˜ˆì œ ì½”ë“œ

**ì±„íŒ… ì„œë¹„ìŠ¤**ë¥¼ ë§Œë“¤ ë•Œ ë‹¤ìŒê³¼ ê°™ì€ `í´ë§(polling)` ë°©ì‹ì„ ì ìš©í•œë‹¤í•´ë³´ì

- ìœ ì €ê°€ íŠ¹ì • `í† í”½`ì— `ë©”ì„¸ì§€`ë¥¼ ì „ë‹¬í›„ ì €ì¥
- ìœ ì €ê°€ ì£¼ê¸°ì ìœ¼ë¡œ ì„œë²„ì— ì›í•˜ëŠ” `í† í”½`ì˜ `ì „ì²´ ë©”ì„¸ì§€`ë¥¼ ìš”ì²­

ìœ„ ë°©ì‹ì˜ ì˜ˆì œ ì½”ë“œë¥¼ ë³´ì.

```java
//ì±„íŒ… ì„œë²„ í´ë˜ìŠ¤
public class ChatServer {
    //íŠ¹ì • í† í”½ì˜ ë©”ì„¸ì§€ ë¦¬ìŠ¤íŠ¸
    private Map<String, List<String>> messages = new HashMap<>();

    //í† í”½ì— ë©”ì„¸ì§€ ì¶”ê°€
    public void addMessage(String topic, String message) {
        //í† í”½ ì¡´ì¬ì‹œ
        if (this.messages.containsKey(topic)) {
            //í† í”½ì— ë©”ì„¸ì§€ ì¶”ê°€
            this.messages.get(topic).add(message);
        } else {
            List<String> messageList = new ArrayList<>();
            //ë©”ì„¸ì§€ ì¶”ê°€
            messageList.add(message);
            //í† í”½ ì¶”ê°€
            this.messages.put(topic, messageList);
        }
    }

    //í† í”½ ë©”ì„¸ì§€ ì–»ê¸°
    public List<String> getMessage(String topic) {
        return this.messages.get(topic);
    }
}
```

```java
//ì±„íŒ…ì„ ì´ìš©í•˜ëŠ” í´ë¼ì´ì–¸íŠ¸ í´ë˜ìŠ¤
public class Client {
    private final ChatServer chatServer;
    private final String name;

    //ì±„íŒ… ì„œë²„ì™€ Client ì´ë¦„ ë°›ê¸°
    public Client(ChatServer chatServer, String name) {
        this.chatServer = chatServer;
        this.name = name;
    }

    //í† í”½ì— ë©”ì„¸ì§€ ì „ì†¡
    public void sendMessage(String topic, String message) {
        chatServer.addMessage(topic, message);
    }

    //í•´ë‹¹ í† í”½ ë©”ì„¸ì§€ ì¶œë ¥
    public void printMessage(String topic) {
        List<String > messages = this.getMessage(topic);
        if(Objects.isNull(messages)) return;
                //ë©”ì„¸ì§€ ì¶œë ¥
        System.out.printf("======== ì´ë¦„: %s   í† í”½: %s =======\n", this.name, topic);
        messages.forEach(System.out::println);
    }

    //í•´ë‹¹ í† í”½ ë©”ì„¸ì§€ ì–»ê¸°
    private List<String> getMessage(String topic) {
        return this.chatServer.getMessage(topic);
    }
}
```

```java
public class Main {
    public static void main(String[] args) {
        //ì±„íŒ… ì„œë²„ ìƒì„±
        ChatServer chatServer = new ChatServer();
        //í´ë¼ì´ì–¸íŠ¸ ìƒì„±
        Client client1 = new Client(chatServer, "í™ê¸¸ë™");
        Client client2 = new Client(chatServer, "ì•„ë¬´ê°œ");

        //ì‚¬ëŒì¸ì´ë¼ëŠ” í† í”½ì— ë©”ì„¸ì§€ ì „ì†¡
        client1.sendMessage("ì‚¬ëŒì¸", "ì•ˆë…•í•˜ì„¸ìš”");
        client2.sendMessage("ì‚¬ëŒì¸", "ë°˜ê°‘ìŠµë‹ˆë‹¤");
        //í´ë¼ì´ì–¸íŠ¸ê°€ ì„œë²„ë¡œë¶€í„° ë©”ì„¸ì§€ ì¶œë ¥ í˜¸ì¶œ
        client1.printMessage("ì‚¬ëŒì¸");
        client2.printMessage("ì‚¬ëŒì¸");

        //ì í•ì´ë¼ëŠ” í† í”½ì— ë©”ì„¸ì§€ ì „ì†¡
        client1.sendMessage("ì í•", "ì˜ë¶€íƒë“œë¦½ë‹ˆë‹¤");
        //í´ë¼ì´ì–¸íŠ¸ê°€ ì„œë²„ë¡œë¶€í„° ë©”ì„¸ì§€ ì¶œë ¥ í˜¸ì¶œ
        client2.printMessage("ì í•");
    }
}

ê²°ê³¼
======== ì´ë¦„: í™ê¸¸ë™   í† í”½: ì‚¬ëŒì¸ =======
ì•ˆë…•í•˜ì„¸ìš”
ë°˜ê°‘ìŠµë‹ˆë‹¤
======== ì´ë¦„: ì•„ë¬´ê°œ   í† í”½: ì‚¬ëŒì¸ =======
ì•ˆë…•í•˜ì„¸ìš”
ë°˜ê°‘ìŠµë‹ˆë‹¤
======== ì´ë¦„: ì•„ë¬´ê°œ   í† í”½: ì í• =======
ì˜ë¶€íƒë“œë¦½ë‹ˆë‹¤
```

ì˜ˆì œì—ì„œ `í´ë¼ì´ì–¸íŠ¸`ëŠ” ë©”ì„¸ì§€ë¥¼ ì¶œë ¥í•˜ê³  ì‹¶ì„ ë•Œë§ˆë‹¤ `ì±„íŒ… ì„œë²„`ì— ìš”ì²­ì„ ë³´ë‚¸ë‹¤.

ì´ ë°©ì‹ì˜ ë¬¸ì œëŠ” ì „ë‹¬ëœ ë©”ì„¸ì§€ëŠ” ì—†ì§€ë§Œ `í´ë¼ì´ì–¸íŠ¸`ê°€ ì£¼ê¸°ì ìœ¼ë¡œ ì„œë²„ì— ë©”ì„¸ì§€ë¥¼ ìš”ì²­í•˜ë©´ ë¶ˆí•„ìš”í•œ ì‘ì—…ì´ ëŠ˜ì–´ë‚˜ ë¦¬ì†ŒìŠ¤ê°€ ë‚­ë¹„ëœë‹¤ëŠ” ì ì´ë‹¤.

`ì˜µì €ë²„ íŒ¨í„´`ì„ ì‚¬ìš©í•˜ë©´ ë©”ì„¸ì§€ ì „ë‹¬ì„ ê°ì§€í•˜ì—¬ `í´ë¼ì´ì–¸íŠ¸`ê°€ ë¶ˆí•„ìš”í•œ ì‘ì—…ì„ ì—†ì•¨ ìˆ˜ ìˆë‹¤.

íŒ¨í„´ì„ ì ìš©í•œ ì˜ˆì œë¥¼ ë³´ì

**ìš”êµ¬ì‚¬í•­**ì€ ë‹¤ìŒê³¼ ê°™ë‹¤

- ìœ ì €ëŠ” íŠ¹ì • `í† í”½`ì„ êµ¬ë… ê°€ëŠ¥
- ìœ ì €ê°€ êµ¬ë…í•œ `í† í”½`ì— `ë©”ì„¸ì§€`ë¥¼ ì „ì†¡ì‹œ `í† í”½`ì„ êµ¬ë…í•œ ë‹¤ë¥¸ ìœ ì €ëŠ” `ë©”ì„¸ì§€` í™•ì¸ ê°€ëŠ¥

![Untitled](https://user-images.githubusercontent.com/32676275/158595711-7b63d418-90ae-44dd-b9d3-3c2ea4262f23.png)

```java
/**
 * êµ¬ë…ì ì¸í„°í˜ì´ìŠ¤
 * ** Observer **
 */
public interface Subscriber {
        //ì „ë‹¬ë°›ì€ ë©”ì„¸ì§€ ì²˜ë¦¬ ë©”ì†Œë“œ
    void handleMessage(String message);
}
```

```java
/**
 * Subscriber ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„ì²´
 * ** ConcreteObserver **
 */
public class User implements Subscriber{
    //ìœ ì € ì´ë¦„
    private final String name;

    //ìƒì„±ì
    public User(String name) {
        this.name = name;
    }

    //ë©”ì„¸ì§€ ì²˜ë¦¬
    @Override
    public void handleMessage(String message) {
        System.out.printf("%s --- %s ìˆ˜ì‹ \n",message,this.name);
    }
    //Getter
}
```

```java
/**
 * ì±„íŒ… ì„œë²„ í´ë˜ìŠ¤
 * ** Subject **
 */
public class ChatServer {
    //ê° í† í”½ì— êµ¬ë…ìë“¤ì„ ì €ì¥
    public Map<String, List<Subscriber>> subscribers = new HashMap<>();

    //êµ¬ë… ë“±ë¡
    public void register(String topic, Subscriber subscriber) {
        //í† í”½ ì¡´ì¬ì‹œ êµ¬ë…ì ì¶”ê°€
        if(this.subscribers.containsKey(topic)) {
            this.subscribers.get(topic).add(subscriber);
            return;
        }
        //ì¡´ì¬í•˜ì§€ ì•Šì„ì‹œ í† í”½ ìƒì„±í›„ ì¶”ê°€
        List<Subscriber> newSubscribers = new ArrayList<>();
        newSubscribers.add(subscriber);
        this.subscribers.put(topic, newSubscribers);
    }

    //êµ¬ë… ì·¨ì†Œ
    public void unregister(String topic, Subscriber subscriber) {
        //í† í”½ ì¡´ì¬ì‹œ í† í”½ì˜ êµ¬ë…ì ì œê±°
        if(this.subscribers.containsKey(topic)) {
            this.subscribers.get(topic).remove(subscriber);
        }
    }

    //í† í”½ì˜ êµ¬ë…ìë“¤ì—ê²Œ ë©”ì„¸ì§€ ì „ì†¡
    public void sendMessage(User user, String topic, String message) {
        // í•´ë‹¹ í† í”½ì´ ì¡´ì¬ì‹œ
        if (this.subscribers.containsKey(topic)) {
            String userMessage = user.getName() + ": " + message;
            // í† í”½ êµ¬ë…ìë“¤ì—ê²Œ ë©”ì„¸ì§€ ì „ë‹¬
            this.subscribers.get(topic).forEach(s -> s.handleMessage(userMessage));
        }
    }
}
```

```java
public class Main {
    public static void main(String[] args) {
        ChatServer chatServer = new ChatServer();
        User user1 = new User("í™ê¸¸ë™");
        User user2 = new User("ì•„ë¬´ê°œ");

        System.out.println("==========ê° í† í”½ì— êµ¬ë…ìê°€ 1ëª…ì¼ ë•Œ==========");
        chatServer.register("ê°œë°œ", user1);   //êµ¬ë…
        chatServer.register("ê¸°íš", user2);   //êµ¬ë…
        chatServer.sendMessage(user1, "ê°œë°œ", "ê°œë°œ í† í”½ì— ë©”ì„¸ì§€ ì „ë‹¬");   //ë©”ì‹œì§€ì „ì†¡
        chatServer.sendMessage(user2, "ê¸°íš", "ê¸°íš í† í”½ì— ë©”ì„¸ì§€ ì „ë‹¬");   //ë©”ì‹œì§€ì „ì†¡

        System.out.println("==========êµ¬ë…ì ì¶”ê°€í›„ ë©”ì„¸ì§€ ì „ë‹¬==========");
        chatServer.register("ê¸°íš", user1);   //êµ¬ë…
        chatServer.sendMessage(user1, "ê¸°íš", "ê¸°íš êµ¬ë…í›„ ë©”ì„¸ì§€ ì „ë‹¬");   //ë©”ì‹œì§€ì „ì†¡

        System.out.println("==========êµ¬ë… ì·¨ì†Œí›„ ë©”ì„¸ì§€ ì „ë‹¬==========");
        chatServer.unregister("ê¸°íš", user2);  //êµ¬ë… ì·¨ì†Œ
        chatServer.sendMessage(user2, "ê¸°íš", "ê¸°íš êµ¬ë… ì·¨ì†Œí›„ ë©”ì„¸ì§€ ì „ë‹¬");  //ë©”ì‹œì§€ ì „ì†¡
    }
}

ê²°ê³¼
==========ê° í† í”½ì— êµ¬ë…ìê°€ 1ëª…ì¼ ë•Œ==========
í™ê¸¸ë™: ê°œë°œ í† í”½ì— ë©”ì„¸ì§€ ì „ë‹¬ --- í™ê¸¸ë™ ìˆ˜ì‹ 
ì•„ë¬´ê°œ: ê¸°íš í† í”½ì— ë©”ì„¸ì§€ ì „ë‹¬ --- ì•„ë¬´ê°œ ìˆ˜ì‹ 
==========êµ¬ë…ì ì¶”ê°€í›„ ë©”ì„¸ì§€ ì „ë‹¬==========
í™ê¸¸ë™: ê¸°íš êµ¬ë…í›„ ë©”ì„¸ì§€ ì „ë‹¬ --- ì•„ë¬´ê°œ ìˆ˜ì‹ 
í™ê¸¸ë™: ê¸°íš êµ¬ë…í›„ ë©”ì„¸ì§€ ì „ë‹¬ --- í™ê¸¸ë™ ìˆ˜ì‹ 
==========êµ¬ë… ì·¨ì†Œí›„ ë©”ì„¸ì§€ ì „ë‹¬==========
ì•„ë¬´ê°œ: ê¸°íš êµ¬ë… ì·¨ì†Œí›„ ë©”ì„¸ì§€ ì „ë‹¬ --- í™ê¸¸ë™ ìˆ˜ì‹ 
```

`ì˜µì €ë²„ íŒ¨í„´`ì„ ì ìš©í•˜ë©´ `ChatServer(Subject)` ì—ì„œ `User(Observer)` ë¦¬ìŠ¤íŠ¸ë¥¼ ê°€ì§€ê³  ìˆëŠ” êµ¬ì¡°ê°€ ëœë‹¤.

`ChatServer.sendMessage()`ë©”ì†Œë“œ í˜¸ì¶œì‹œ `User(Observer).handleMessage()` ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•¨ìœ¼ë¡œì¨ **ìœ ì €ëŠ” ë©”ì„¸ì§€ê°€ ì „ë‹¬ë˜ëŠ” ì‹œì ì— ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” êµ¬ì¡°ê°€ ëœë‹¤.**

## íŒ¨í„´ì˜ ì¥/ë‹¨ì 

âœ… ì¥ì :

- OCP(ê°œë°©/íì‡„ì›ì¹™)  ìƒˆë¡œìš´ êµ¬ë…ì í´ë˜ìŠ¤ë¥¼ ë°œí–‰ìì˜ ì½”ë“œ ë³€ê²½ ì—†ì´ ì¶”ê°€ ê°€ëŠ¥. ê·¸ë¦¬ê³  ê·¸ ë°˜ëŒ€ë¡œ ë°œí–‰ì ì¸í„°í˜ì´ìŠ¤ê°€ ìˆë‹¤ëŠ” ê°€ì •í•˜ì— ì—­ë„ ì„±ë¦½í•œë‹¤.
- ëŸ°íƒ€ì„ì•ˆì— ê°ì²´ê°„ ê´€ê³„ë¥¼ ì„±ë¦½í•  ìˆ˜ìˆë‹¤. 

ğŸš¨ ë‹¨ì :

- êµ¬ë…ìë“¤ì€ ëœë¤ìœ¼ë¡œ ì•ŒëŒì´ ê°„ë‹¤.  (ìˆœì„œê°€ ì¤‘ìš”í•˜ë©´ ì‚¬ìš© ë¶ˆê°€)

## ë¹„ìŠ·í•œ íŒ¨í„´

- **ì±…ì„ì—°ì‡„íŒ¨í„´, ì»¤ë§¨ë“œíŒ¨í„´, ì¤‘ì œì, ì˜µì €ë²„**ëŠ” ìš”ì²­ì— ëŒ€í•œ ë°œì†¡ìì™€ ìˆ˜ì‹ ì ì—°ê²° ë°©ì‹ì´ ë‹¤ì–‘í•˜ë‹¤.
  
  - **ì±…ì„ì—°ì‡„íŒ¨í„´**ì€ ì ì¬ì ì¸ ë¦¬ì‹œë²„ì¤‘ í•˜ë‚˜ê°€ ì²˜ë¦¬ë ë•Œê¹Œì§€ ìš”ì²­ì„ ë™ì ì¸ ë¦¬ì‹œë²„ì²´ì¸ì— ë”°ë¼ì„œ ìˆœì°¨ì ì¸ ì²˜ë¦¬ë¥¼ í•œë‹¤. 
  
  - **ì»¤ë§¨ë“œ íŒ¨í„´**ì€ ìˆ˜ì‹ ìì™€ ì†¡ì‹ ì ì‚¬ì´ì˜ ë‹¨ë°©í–¥ì˜ ì—°ê²°ì„ ì„¤ë¦½í•œë‹¤.
  
  - **ì¤‘ì œì íŒ¨í„´**ì€ ì†¡ì‹ ìì™€ ìˆ˜ì‹ ìë¥¼ ì§ì ‘ì ì¸ í†µì‹ ì€ ë°°ì œí•˜ê³  ì¤‘ì œì ê°ì²´ë¥¼ í†µí•œ ê°„ì ‘ì ì¸ ì†Œí†µ ê°€ëŠ¥í•˜ë„ë¡ ê°•ì œí•œë‹¤.
  
  - **ì˜µì €ë²„ íŒ¨í„´**ì€ ìˆ˜ì‹ ìì˜ ì „ë‹¬ë°›ì€ ìš”ì²­ìœ¼ë¡œë¶€í„° ë™ì ìœ¼ë¡œ êµ¬ë…í•˜ê±°ë‚˜ ë¹„êµ¬ë…í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ êµ¬ì„±í•œë‹¤
